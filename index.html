<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Threat Hunter - Cyber Defense Game</title>
  <style>
    body {
      margin: 0;
      background: radial-gradient(circle at top, #1b3358 0%, #050810 55%, #020308 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
      color: #fff;
    }

    #gameContainer {
      position: relative;
      width: 800px;
      height: 500px;
      border-radius: 10px;
      border: 2px solid #00e5ff;
      box-shadow: 0 0 25px rgba(0, 229, 255, 0.4);
      background: radial-gradient(circle at center, #151521 0%, #050509 70%);
      overflow: hidden;
    }

    #gameCanvas {
      display: block;
      background: repeating-linear-gradient(
        to bottom,
        #050509,
        #050509 10px,
        #090914 10px,
        #090914 20px
      );
    }

    #hud {
      position: absolute;
      top: 8px;
      left: 8px;
      font-size: 14px;
      text-shadow: 0 0 4px #000;
      line-height: 1.4;
    }

    #hud span.label {
      color: #9bd1ff;
      font-weight: bold;
    }

    #legend {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(2, 6, 18, 0.85);
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 11px;
      border: 1px solid #1f4068;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      max-width: 210px;
    }

    #legend-title {
      font-weight: bold;
      margin-bottom: 4px;
      color: #9bd1ff;
      text-align: center;
    }

    .legend-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 2px 0;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    .legend-threat { background: #ff4b4b; }
    .legend-safe   { background: #00c853; }

    #message {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 15px;
      text-shadow: 0 0 6px #000;
      text-align: center;
      max-width: 90%;
    }

    #crosshair {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid #ff0000;
      pointer-events: none;
      box-shadow: 0 0 8px #f00;
    }

    #centerDot {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #ff0000;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 4px #f00;
    }

    #startOverlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
    }

    #startOverlay h1 {
      margin-bottom: 10px;
      color: #ff4b4b;
      text-shadow: 0 0 8px #f00;
      font-size: 28px;
    }

    #startOverlay p {
      max-width: 420px;
    }

    #startOverlay button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background: #ff3333;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 0 8px #f00;
    }

    #startOverlay button:hover {
      background: #ff5555;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="gameCanvas" width="800" height="500"></canvas>

    <div id="hud">
      <div><span class="label">Score:</span> <span id="score">0</span></div>
      <div><span class="label">Health:</span> <span id="health">3</span></div>
      <div><span class="label">Items on screen:</span> <span id="threats">0</span></div>
    </div>

    <div id="legend">
      <div id="legend-title">Threat Hunter</div>
      <div class="legend-row">
        <span class="legend-dot legend-threat"></span> Shoot these (THREATS)
      </div>
      <div class="legend-row">
        <span class="legend-dot legend-safe"></span> Do NOT shoot (SAFE)
      </div>
    </div>

    <div id="message"></div>
    <div id="crosshair"></div>
    <div id="centerDot"></div>

    <div id="startOverlay">
      <h1>Threat Hunter</h1>
      <p>
        You are a Security Analyst.  
        Shoot <strong>only the cyber threats</strong> (red items).  
        Let safe behavior and good security practices pass.
      </p>
      <p style="font-size: 13px; margin-top: 6px;">
        +10 points for stopping a threat.  
        Lose 1 health for missing a threat or shooting something safe.
      </p>
      <button onclick="startGame()">Start Game</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const scoreEl = document.getElementById('score');
    const healthEl = document.getElementById('health');
    const threatsEl = document.getElementById('threats');
    const messageEl = document.getElementById('message');
    const crosshairEl = document.getElementById('crosshair');
    const startOverlay = document.getElementById('startOverlay');
    const container = document.getElementById('gameContainer');

    let entities = [];
    let score = 0;
    let health = 3;
    let isGameOver = false;
    let lastSpawnTime = 0;
    let spawnInterval = 1500;
    let lastTime = 0;

    /**
     * type: 'image' | 'text'
     * isThreat: true (shoot) | false (do not shoot)
     * imgSrc: for image cards
     * text: full prompt for text cards
     */
    const CARDS = [
      // ------- IMAGE THREATS -------
      {
        id: 'file_explorer',
        type: 'image',
        label: 'Suspicious files in downloads',
        imgSrc: 'assets/File Explorer.jpg',
        isThreat: true,
        onShoot: 'Nice catch! Files like â€œImportant_Invoice.pdf.exeâ€ are usually malware.',
        onMiss: 'You ignored a malicious attachment. It could infect the system.'
      },
      {
        id: 'permission_app',
        type: 'image',
        label: 'Odd app permissions',
        imgSrc: 'assets/Permission app.jpg',
        isThreat: true,
        onShoot: 'Correct. A calculator shouldnâ€™t need access to your contacts.',
        onMiss: 'Granting excessive permissions can leak private data.'
      },
      {
        id: 'remote_access',
        type: 'image',
        label: 'Remote access request',
        imgSrc: 'assets/Remote Access.jpg',
        isThreat: true,
        onShoot: 'Good job. Unwanted remote access can give attackers control.',
        onMiss: 'You allowed remote access â€” an attacker could now control this PC.'
      },
      {
        id: 'warning_ssl',
        type: 'image',
        label: 'Connection not private',
        imgSrc: 'assets/warning.jpg',
        isThreat: true,
        onShoot: 'Correct. Certificate warnings can mean someone is intercepting traffic.',
        onMiss: 'Ignoring this warning can expose passwords and credit cards.'
      },
      {
        id: 'wifi_public',
        type: 'image',
        label: 'Random public Wi-Fi',
        imgSrc: 'assets/wifi.jpg',
        isThreat: true,
        onShoot: 'Nice. Public Wi-Fi can let attackers snoop on your traffic.',
        onMiss: 'Connecting to random open Wi-Fi is risky without a VPN.'
      },
      {
        id: 'gnome_weird',
        type: 'image',
        label: 'Strange meme link',
        imgSrc: 'assets/profile.jpg',
        isThreat: true,
        onShoot: 'Even funny memes from unknown links can bundle malware.',
        onMiss: 'You trusted a weird link that could have delivered malware.'
      },

      // ------- IMAGE SAFES -------
      {
        id: 'https_safe',
        type: 'image',
        label: 'Secure HTTPS site',
        imgSrc: 'assets/https.jpg',
        isThreat: false,
        onShoot: 'This was safe â€” HTTPS with the lock is usually a good sign.',
        onMiss: 'Good job. Using HTTPS helps protect data in transit.'
      },
      {
        id: 'weather_location',
        type: 'image',
        label: 'Weather app location request',
        imgSrc: 'assets/iOS asking for location.png',
        isThreat: false,
        onShoot: 'This is normally safe â€” a weather app needs your location.',
        onMiss: 'Correct to allow. Some apps legitimately use your location.'
      },
      {
        id: 'location_usage',
        type: 'image',
        label: 'App explains location use',
        imgSrc: 'assets/safe ios.jpg',
        isThreat: false,
        onShoot: 'This prompt is transparent about location use and is usually safe.',
        onMiss: 'Letting this continue is fine if you trust the app.'
      },
      {
        id: 'windows_update',
        type: 'image',
        label: 'Official Windows Update',
        imgSrc: 'assets/WINDOWS UPDATE.png',
        isThreat: false,
        onShoot: 'These official updates fix security issuesâ€”you shouldnâ€™t block them.',
        onMiss: 'Keeping your system updated is a key security best practice.'
      },

      // ------- TEXT THREATS -------
      {
        id: 'usb_parking_lot',
        type: 'text',
        label: 'Mysterious USB',
        text: 'You find a USB drive in the parking lot labeled â€œSalary_2025â€.\nDo you plug it into your work computer?',
        isThreat: true,
        onShoot: 'Correct. Plugging in unknown USB drives can install malware.',
        onMiss: 'You ignored this threat and could have infected the network.'
      },
      {
        id: 'sms_phishing',
        type: 'text',
        label: 'Text message link',
        text: 'You get a text claiming your package is held.\nIt includes a shortened link to â€œverifyâ€ your card.',
        isThreat: true,
        onShoot: 'Nice. Phishing texts often use urgent language and weird links.',
        onMiss: 'Clicking that link could steal your payment information.'
      },
      {
        id: 'mfa_bombing',
        type: 'text',
        label: 'MFA prompt bombing',
        text: 'Your phone starts receiving nonstop MFA push notifications\nfor a login you did not start.',
        isThreat: true,
        onShoot: 'Correct. Attackers may spam MFA to trick you into approving.',
        onMiss: 'Approving random MFA requests can give attackers account access.'
      },

      // ------- TEXT SAFES -------
      {
        id: 'password_manager',
        type: 'text',
        label: 'Password manager',
        text: 'You install a reputable password manager\nfrom the official app store to store unique passwords.',
        isThreat: false,
        onShoot: 'Password managers are recommended â€” shooting this was a mistake.',
        onMiss: 'Good choice. Strong, unique passwords improve security.'
      },
      {
        id: 'auto_updates',
        type: 'text',
        label: 'Automatic updates',
        text: 'You enable automatic security updates\nfor your laptopâ€™s operating system.',
        isThreat: false,
        onShoot: 'Keeping updates on is safe â€” donâ€™t block legitimate security patches.',
        onMiss: 'Nice. Automatic updates help patch vulnerabilities quickly.'
      },
      {
        id: 'report_phishing',
        type: 'text',
        label: 'Report phishing',
        text: 'You receive a suspicious email\nand use the â€œReport phishingâ€ button instead of clicking.',
        isThreat: false,
        onShoot: 'Reporting suspicious emails is good practice â€” this was safe.',
        onMiss: 'Correct. Reporting gives security teams a chance to block the attack.'
      }
    ];

    // Preload images for image cards
    CARDS.forEach(card => {
      if (card.type === 'image' && card.imgSrc) {
        const img = new Image();
        img.src = card.imgSrc;
        card.img = img;
      }
    });

    function resetGame() {
      entities = [];
      score = 0;
      health = 3;
      isGameOver = false;
      spawnInterval = 1500;
      lastSpawnTime = 0;
      lastTime = 0;
      messageEl.textContent = '';
      updateHUD();
    }

    function startGame() {
      startOverlay.style.display = 'none';
      resetGame();
      requestAnimationFrame(gameLoop);
    }

    function spawnEntity() {
      const card = CARDS[Math.floor(Math.random() * CARDS.length)];
      const width = 170;
      const height = 120;
      const x = Math.random() * (canvas.width - width - 80) + 40 + width / 2;
      const speed = 0.5 + Math.random() * 0.45;

      entities.push({
        x,
        y: -height,
        w: width,
        h: height,
        speed,
        card
      });

      threatsEl.textContent = entities.length;
    }

    function update(delta) {
      if (isGameOver) return;

      if (lastTime - lastSpawnTime > spawnInterval) {
        spawnEntity();
        lastSpawnTime = lastTime;
        if (spawnInterval > 750) {
          spawnInterval -= 12;
        }
      }

      for (let i = entities.length - 1; i >= 0; i--) {
        const e = entities[i];
        e.y += e.speed * (delta / 16);

        if (e.y > canvas.height - 40) {
          const card = e.card;

          if (card.isThreat) {
            // missed a threat â†’ lose health
            health--;
            showFact(card.onMiss || 'You let a threat through!', '#ff6666');
            if (health <= 0) {
              health = 0;
              entities.splice(i, 1);
              updateHUD();
              gameOver();
              return;
            }
          } else {
            // allowed a safe behavior
            showFact(card.onMiss || 'Good. This was safe to allow.', '#66ff66');
          }

          entities.splice(i, 1);
        }
      }

      updateHUD();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = '#111423';
      ctx.fillRect(0, 0, 40, canvas.height);
      ctx.fillRect(canvas.width - 40, 0, 40, canvas.height);

      const grd = ctx.createLinearGradient(0, canvas.height * 0.6, 0, canvas.height);
      grd.addColorStop(0, '#151522');
      grd.addColorStop(1, '#050509');
      ctx.fillStyle = grd;
      ctx.fillRect(0, canvas.height * 0.6, canvas.width, canvas.height * 0.4);

      entities.forEach(e => {
        const { card } = e;
        const x = e.x - e.w / 2;
        const y = e.y - e.h / 2;

        // Card background
        ctx.fillStyle = 'rgba(5, 10, 25, 0.95)';
        ctx.fillRect(x, y, e.w, e.h);

        // Border color: red threat, green safe
        ctx.strokeStyle = card.isThreat ? '#ff4b4b' : '#00c853';
        ctx.lineWidth = 2;
        ctx.strokeRect(x, y, e.w, e.h);

        if (card.type === 'image') {
          if (card.img && card.img.complete) {
            ctx.drawImage(card.img, x + 5, y + 5, e.w - 10, e.h - 35);
          }
        } else if (card.type === 'text') {
          ctx.fillStyle = '#ffffff';
          ctx.font = '11px Arial';
          ctx.textAlign = 'left';
          const lines = card.text.split('\n');
          let ty = y + 18;
          lines.forEach(line => {
            ctx.fillText(line, x + 8, ty);
            ty += 13;
          });
        }

        // Label at bottom
        ctx.fillStyle = '#ffffff';
        ctx.font = '11px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(card.label, e.x, y + e.h - 6);
      });

      ctx.fillStyle = '#2b0710';
      ctx.fillRect(0, canvas.height - 40, canvas.width, 40);
      ctx.fillStyle = '#ff4b4b';
      ctx.font = 'bold 18px Arial';
      ctx.textAlign = 'left';
      ctx.fillText('THREAT HUNTER', 10, canvas.height - 14);
    }

    function gameLoop(timestamp) {
      if (!lastTime) lastTime = timestamp;
      const delta = timestamp - lastTime;
      lastTime = timestamp;

      update(delta);
      draw();

      if (!isGameOver) {
        requestAnimationFrame(gameLoop);
      }
    }

    function updateHUD() {
      scoreEl.textContent = score;
      healthEl.textContent = health;
      threatsEl.textContent = entities.length;
    }

    function showFact(text, color = '#66ff66') {
      messageEl.style.color = color;
      messageEl.textContent = text;
      clearTimeout(messageEl._timeout);
      messageEl._timeout = setTimeout(() => {
        messageEl.textContent = '';
      }, 3200);
    }

    function gameOver() {
      isGameOver = true;
      showFact('GAME OVER â€“ Your defenses failed. ðŸ’€', '#ff4444');
      setTimeout(() => {
        startOverlay.style.display = 'flex';
        startOverlay.querySelector('p').innerHTML =
          'Final Score: ' + score +
          '<br>Refresh or click <strong>Start Game</strong> to play again.';
      }, 1200);
    }

    function getMousePos(evt) {
      const r = canvas.getBoundingClientRect();
      return {
        x: evt.clientX - r.left,
        y: evt.clientY - r.top
      };
    }

    canvas.addEventListener('click', (evt) => {
      if (isGameOver) return;
      const pos = getMousePos(evt);

      for (let i = entities.length - 1; i >= 0; i--) {
        const e = entities[i];
        const left = e.x - e.w / 2;
        const right = e.x + e.w / 2;
        const top = e.y - e.h / 2;
        const bottom = e.y + e.h / 2;

        if (pos.x >= left && pos.x <= right && pos.y >= top && pos.y <= bottom) {
          const card = e.card;

          if (card.isThreat) {
            // correct: shot a threat
            score += 10;
            showFact(card.onShoot || 'Threat neutralized.', '#66ff66');
          } else {
            // wrong: shot a safe item
            health--;
            showFact(card.onShoot || 'You blocked something safe.', '#ff6666');
            if (health <= 0) {
              health = 0;
              entities.splice(i, 1);
              updateHUD();
              gameOver();
              return;
            }
          }

          entities.splice(i, 1);
          updateHUD();
          return;
        }
      }
    });

    container.addEventListener('mousemove', (evt) => {
      const r = container.getBoundingClientRect();
      const x = evt.clientX - r.left;
      const y = evt.clientY - r.top;

      crosshairEl.style.left = (x - 10) + 'px';
      crosshairEl.style.top = (y - 10) + 'px';
    });
  </script>
</body>
</html>
